(this["webpackJsonpdraftjs-filters"]=this["webpackJsonpdraftjs-filters"]||[]).push([[0],{100:function(e,t,n){},101:function(e,t,n){},102:function(e,t,n){},198:function(e,t,n){},199:function(e,t,n){"use strict";n.r(t);var r=n(0),i=n(4),a=n(48),o=n.n(a),c=(n(93),n(94),n(95),n(96),n(97),n(98),n(99),n(100),n(101),n(20)),s=n(21),l=n(23),d=n(22),u=(n(102),n(12)),h=n(1),f="atomic",p="unstyled",g="unordered-list-item",b="ordered-list-item",j=function(e){var t=e.getBlockMap(),n=t.filter((function(e){var t=e.getText();return e.getEntityAt(0)&&["\ud83d\udcf7"," ","\ud83d\udcf7 "].includes(t)})).map((function(e){return e.set("type",f)}));return 0!==n.size?e.merge({blockMap:t.merge(n)}):e},m=function(e){var t=e.getBlockMap(),n=t.filter((function(e){return e.getType()===f&&(" "!==e.getText()||0!==e.getInlineStyleAt(0).size)})).map((function(e){var t=e.getCharacterList().slice(0,1).map((function(e){var t=e;return e.getStyle().forEach((function(e){t=h.CharacterMetadata.removeStyle(t,e)})),t}));return e.merge({text:" ",characterList:t})}));return 0!==n.size&&(t=t.merge(n)),e.merge({blockMap:t})},y=function(e,t){var n=t.getBlockMap(),r=n.filter((function(n){if(n.getType()!==f)return!0;var r,i=n.getEntityAt(0);if(i){var a=t.getEntity(i).getType();r=e.some((function(e){return e.type===a}))}else r=!1;return r}));return r.size!==n.size?t.merge({blockMap:r}):t},v=function(e){var t=e.getBlockMap(),n=t.filter((function(e){return[g,b].includes(e.getType())||0===e.getDepth()}));return n.size!==t.size?e.merge({blockMap:n}):e},O=function(e,t){var n=t.getBlockMap(),r=n.filter((function(e){return"unstyled"===e.getType()})).map((function(t){var n,r=t.getText(),i=t,a=e.find((function(e){return null!==(n=new RegExp(e.test).exec(r))}));if(a&&n&&n[0]){var o=t.getText();if(t.getEntityAt(0)&&n[0]===o)return i;for(var c=n[0].length,s=t.getCharacterList(),l=0;l<c;)s=s.shift(),l++;i=i.merge({type:a.type,depth:a.depth,text:o.slice(c),characterList:s})}return i}));return 0===r.size?t:t.merge({blockMap:n.merge(r)})},x=function(e,t){var n=t.getBlockMap(),r=n.filter((function(t){return t.getDepth()>e})).map((function(t){return t.set("depth",e)}));return 0===r.size?t:t.merge({blockMap:n.merge(r)})},k=function(e,t){var n=t.getBlockMap(),r=n.filter((function(t){return!e.includes(t.getType())})).map((function(e){return e.merge({type:p,depth:0})}));return 0===r.size?t:t.merge({blockMap:n.merge(r)})},C=function(e,t){var n=t.getBlockMap(),r=n.map((function(t){var n=!1,r=t.getCharacterList().map((function(t){var r=t;return t.getStyle().filter((function(t){return!e.includes(t)})).forEach((function(e){n=!0,r=h.CharacterMetadata.removeStyle(r,e)})),r}));return n?t.set("characterList",r):t}));return t.merge({blockMap:n.merge(r)})},E=function(e){var t=e,n=t.getBlockMap(),r=[],i=function(e){var t=e.getEntity();if(t){if(r.includes(t))return!0;r.push(t)}return!1},a=n.map((function(e){var n=e.getCharacterList(),r=!1;return e.findEntityRanges(i,(function(e,i){var a=n.get(e).getEntity(),o=t.getEntity(a),c=(t=t.createEntity(o.getType(),o.getMutability(),o.getData())).getLastCreatedEntityKey();n=n.map((function(t,n){return e<=n&&n<=i?h.CharacterMetadata.applyEntity(t,c):t})),r=!0})),r?e.set("characterList",n):e}));return t.merge({blockMap:n.merge(a)})},w=function(e,t){var n=t.getBlockMap(),r=n.map((function(n){var r=!1,i=n.getCharacterList().map((function(i){var a=i.getEntity();if(a&&!e(t,a,n))return r=!0,h.CharacterMetadata.applyEntity(i,null);return i}));return r?n.set("characterList",i):n}));return t.merge({blockMap:n.merge(r)})},S=function(e,t){var n=t,r={};return n.getBlockMap().forEach((function(e){e.findEntityRanges((function(e){var t=e.getEntity();if(t){var i=n.getEntity(t);r[t]=i}}))})),Object.keys(r).forEach((function(t){var i=r[t],a=i.getData(),o=e.find((function(e){return e.type===i.getType()})),c=o?o.attributes:null;if(!c)return a;var s=c.reduce((function(e,t){return a.hasOwnProperty(t)&&(e[t]=a[t]),e}),{});n=n.replaceEntityData(t,s)})),n},M=function(e,t){var n=t.getBlockMap(),r=n.map((function(t){var n=t.getText(),r=e.reduce((function(e,t){return e.replace(new RegExp(t,"g")," ".repeat(t.length))}),n);return n!==r?t.set("text",r):t}));return t.merge({blockMap:n.merge(r)})},D=[{test:"^(\xb7 |\u2022\t|\u2022|\ud83d\udcf7 |\t| \t)",type:"unordered-list-item",depth:0},{test:"^(\u25e6|o |o\t)",type:"unordered-list-item",depth:1},{test:"^(\xa7 |\uf0a7\t|\u25fe)",type:"unordered-list-item",depth:2},{test:"^1{0,1}\\d\\.[ \t]",type:"ordered-list-item",depth:0},{test:"^x{0,1}(i|ii|iii|iv|v|vi|vii|viii|ix|x)\\.[ \t]",type:"ordered-list-item",depth:2},{test:"^[a-z]\\.[ \t]",type:"ordered-list-item",depth:1}],B=function(e,t){var n=e.blocks,r=e.styles,i=e.entities,a=e.maxNesting,o=e.whitespacedCharacters,c=e.blockTextRules,s=[v,O.bind(null,void 0===c?D:c),x.bind(null,a),C.bind(null,r),k.bind(null,n.concat([p,f])),j,m,w.bind(null,(function(e,t,n){var r,a=e.getEntity(t),o=a.getData(),c=a.getType(),s=n.getType();return r=c,i.some((function(e){return e.type===r}))&&function(e,t,n){var r=e.find((function(e){return e.type===t})),i=r&&r.allowlist?r.allowlist:r&&r.whitelist?r.whitelist:{};return Object.keys(i).every((function(e){var t=i[e];if("boolean"===typeof t){var r=n.hasOwnProperty(e);return t?r:!r}return new RegExp(t).test(n[e])}))}(i,c,o)&&!function(e,t){return"IMAGE"===e&&t!==f}(c,s)})),y.bind(null,i),S.bind(null,i),E,M.bind(null,o)],l=t.getCurrentContent();return function(e,t,n){if(n===t)return e;if(0===n.getBlockMap().size)return h.EditorState.moveFocusToEnd(h.EditorState.set(e,{currentContent:h.ContentState.createFromText("")}));var r=h.EditorState.set(e,{currentContent:n}),i=e.getSelection(),a=i.getAnchorKey(),o=n.getBlockForKey(a);if(!i.isCollapsed()||o)return r;var c=n.getBlockMap().keySeq().reverse().find((function(e){return t.getKeyAfter(e)!==n.getKeyAfter(e)}));if(c){var s=n.getBlockForKey(c).getText().length,l=i.merge({anchorKey:c,focusKey:c,anchorOffset:s,focusOffset:s});return h.EditorState.acceptSelection(r,l)}return r}(t,l,s.reduce((function(e,t){return t(e)}),l))},T=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this,e)).state={error:null},r}return Object(s.a)(n,[{key:"componentDidCatch",value:function(e,t){var n=!!window.Raven;this.setState({error:e}),n&&window.Raven.captureException(e,{extra:t})}},{key:"render",value:function(){var e=this.props.children,t=this.state.error,n=!!window.Raven;return t?Object(r.jsx)("div",{className:"DraftEditor-root",children:Object(r.jsx)("div",{className:"DraftEditor-editorContainer",children:Object(r.jsx)("div",{className:"public-DraftEditor-content",children:Object(r.jsxs)("div",{className:"u-text-center",children:[Object(r.jsx)("p",{children:"Oops. The editor just crashed."}),Object(r.jsx)("p",{children:"Our team has been notified. You can provide us with more information if you want to."}),Object(r.jsxs)("div",{children:[n?Object(r.jsx)("button",{type:"button",onClick:function(){return window.Raven.lastEventId()&&window.Raven.showReportDialog()},children:"Submit a report"}):Object(r.jsx)("a",{href:"https://github.com/thibaudcolas/draftjs-filters/issues",target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"underline"},children:"Open a GitHub issue"}),Object(r.jsx)("span",{children:"\xa0"}),Object(r.jsx)("button",{type:"button",onClick:function(){return window.location.reload(!1)},children:"Reload the page"})]})]})})})}):e}}]),n}(i.Component),L=function(e){var t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)},N=function(e){var t=e.value;return Object(r.jsxs)("div",{style:{position:"relative"},children:[Object(r.jsx)("button",{onClick:L.bind(null,t),style:{position:"absolute",right:"1rem"},children:"Copy"}),Object(r.jsx)("textarea",{style:{width:"100%",resize:"vertical",minHeight:"100px"},readOnly:!0,value:t})]})},R=function(e,t,n){e.findEntityRanges((function(e){var t=e.getEntity();return null!==t&&"LINK"===n.getEntity(t).getType()}),t)},A=function(e){var t=e.contentState,n=e.entityKey,i=e.children,a=t.getEntity(n);return Object(r.jsx)("span",{className:"link",title:a.getData().url,children:i})},I=function(e){var t=e.block,n=e.contentState,i=t.getEntityAt(0),a=i?n.getEntity(i).getData().src:"404.svg";return Object(r.jsx)("img",{src:a,alt:"",width:"256"})},K=(n(198),{unstyled:"P","unordered-list-item":"UL","header-one":"H1","header-two":"H2","header-three":"H3"}),H={unstyled:"P","unordered-list-item":"UL","ordered-list-item":"OL","header-one":"H1","header-two":"H2","header-three":"H3","header-four":"H4","header-five":"H5","header-six":"H6",blockquote:"\u275d","code-block":"{ }"},F={BOLD:"B",ITALIC:"I"},_={BOLD:"B",ITALIC:"I",CODE:"`",STRIKETHROUGH:"~",UNDERLINE:"_"},z=[{type:"LINK",label:"\ud83d\udd17",attributes:["url"],allowlist:{href:"^(http:|https:|undefined$)"}},{type:"IMAGE",label:"\ud83d\udcf7",attributes:["src"],allowlist:{src:"^http|\\./"}}],G=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var r;Object(c.a)(this,n),r=t.call(this,e);var i,a=e.extended,o=new h.CompositeDecorator([{strategy:R,component:A}]),s=window.sessionStorage.getItem("extended");if(a&&s){var l=Object(h.convertFromRaw)(JSON.parse(s));i=h.EditorState.createWithContent(l,o)}else i=h.EditorState.createEmpty(o);return r.state={editorState:i},r.onChange=r.onChange.bind(Object(u.a)(r)),r.keyBindingFn=r.keyBindingFn.bind(Object(u.a)(r)),r.toggleStyle=r.toggleStyle.bind(Object(u.a)(r)),r.toggleBlock=r.toggleBlock.bind(Object(u.a)(r)),r.toggleEntity=r.toggleEntity.bind(Object(u.a)(r)),r.blockRenderer=r.blockRenderer.bind(Object(u.a)(r)),r.handleKeyCommand=r.handleKeyCommand.bind(Object(u.a)(r)),r}return Object(s.a)(n,[{key:"onChange",value:function(e){var t=this.props,n=t.filtered,r=t.extended,i=this.state.editorState,a=e;if(n&&(e.getCurrentContent()!==i.getCurrentContent()&&"insert-fragment"===a.getLastChangeType())){var o={blocks:Object.keys(r?H:K),styles:Object.keys(r?_:F),entities:z,maxNesting:r?4:1,whitespacedCharacters:["\n","\t","\ud83d\udcf7"]};a=B(o,a)}this.setState({editorState:a}),window.sessionStorage.setItem("content",JSON.stringify(Object(h.convertToRaw)(e.getCurrentContent())))}},{key:"toggleStyle",value:function(e,t){var n=this.state.editorState;this.onChange(h.RichUtils.toggleInlineStyle(n,e)),t.preventDefault()}},{key:"toggleBlock",value:function(e,t){var n=this.state.editorState;this.onChange(h.RichUtils.toggleBlockType(n,e)),t.preventDefault()}},{key:"toggleEntity",value:function(e){var t=this.state.editorState,n=t.getCurrentContent();if("IMAGE"===e){var r=(n=n.createEntity(e,"IMMUTABLE",{src:"./word-toolbars-overload.jpg"})).getLastCreatedEntityKey();this.onChange(h.AtomicBlockUtils.insertAtomicBlock(t,r," "))}else{var i=(n=n.createEntity(e,"MUTABLE",{url:"http://www.example.com/"})).getLastCreatedEntityKey(),a=t.getSelection();this.onChange(h.RichUtils.toggleLink(t,a,i))}}},{key:"blockRenderer",value:function(e){return"atomic"!==e.getType()?null:{component:I,editable:!1}}},{key:"keyBindingFn",value:function(e){switch(e.keyCode){case 9:var t=this.props.extended,n=this.state.editorState,r=t?4:1,i=h.RichUtils.onTab(e,n,r);return this.onChange(i),null;default:return Object(h.getDefaultKeyBinding)(e)}}},{key:"handleKeyCommand",value:function(e){var t=this.state.editorState,n=h.RichUtils.handleKeyCommand(t,e);return n?(this.onChange(n),"handled"):"not-handled"}},{key:"render",value:function(){var e=this,t=this.props.extended,n=this.state.editorState,i=t?_:F,a=t?H:K;return Object(r.jsxs)("div",{className:"FilterableEditor",children:[Object(r.jsxs)(T,{children:[Object(r.jsxs)("div",{className:"EditorToolbar",children:[Object.keys(i).map((function(t){return Object(r.jsx)("button",{onMouseDown:e.toggleStyle.bind(e,t),children:_[t]},t)})),Object.keys(a).map((function(t){return Object(r.jsx)("button",{onMouseDown:e.toggleBlock.bind(e,t),children:H[t]},t)})),z.map((function(t){return Object(r.jsx)("button",{onMouseDown:e.toggleEntity.bind(e,t.type),children:t.label},t.type)}))]}),Object(r.jsx)(h.Editor,{editorState:n,onChange:this.onChange,stripPastedStyles:!1,blockRendererFn:this.blockRenderer,keyBindingFn:this.keyBindingFn,handleKeyCommand:this.handleKeyCommand})]}),Object(r.jsxs)("details",{children:[Object(r.jsx)("summary",{children:Object(r.jsx)("span",{className:"link",children:"Debug"})}),Object(r.jsx)(N,{value:JSON.stringify(Object(h.convertToRaw)(n.getCurrentContent()),null,2)})]})]})}}]),n}(i.Component),U=n(49),W=function(){var e=Object(i.useState)(""),t=Object(U.a)(e,2),n=t[0],a=t[1],o=Object(i.useState)([]),c=Object(U.a)(o,2),s=c[0],l=c[1];return Object(i.useEffect)((function(){var e=function(e){var t=e.clipboardData?e.clipboardData.getData("text/plain"):"",n=e.clipboardData?e.clipboardData.getData("text/html"):"";l(s.concat([{text:t,html:n}]))};return document.addEventListener("paste",e),function(){document.removeEventListener("paste",e)}})),Object(r.jsxs)("div",{children:[Object(r.jsx)("p",{children:"Paste here:"}),Object(r.jsx)("textarea",{value:n,onChange:function(e){return a(e.target.value)}}),s.map((function(e,t){var n=e.text,i=e.html;return Object(r.jsxs)("div",{children:[Object(r.jsx)("p",{children:"".concat(t,": ").concat(n.slice(0,50),"\u2026")}),Object(r.jsx)(N,{value:i})]},t)}))]})},q=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"render",value:function(){return Object(r.jsxs)("div",{className:"App",children:[Object(r.jsx)("h2",{children:"With filtering"}),Object(r.jsx)("p",{children:"Rich text pasted into this editor is filtered, keeping only the formats available in the toolbar. Try it out with any of these documents:"}),Object(r.jsxs)("ul",{className:"list-inline",children:[Object(r.jsx)("li",{children:Object(r.jsx)("a",{className:"link",href:"https://docs.google.com/document/d/1YjqkIMC3q4jAzy__-S4fb6mC_w9EssmA6aZbGYWFv80/edit",target:"_blank",rel:"noopener noreferrer",children:"Google Docs"})}),Object(r.jsx)("li",{children:Object(r.jsx)("a",{className:"link",href:"https://paper.dropbox.com/doc/Draft.js-paste-test-document-njfdkwmkeGQ9KICjVwLmU",target:"_blank",rel:"noopener noreferrer",children:"Dropbox Paper"})}),Object(r.jsx)("li",{children:Object(r.jsx)("a",{className:"link",href:"https://1drv.ms/w/s!AuGin45FpiF5hjzm9QdWHYGqPrqm",target:"_blank",rel:"noopener noreferrer",children:"Microsoft Word Online"})})]}),Object(r.jsx)(G,{filtered:!0,extended:!1}),Object(r.jsx)("h2",{children:"Without filtering"}),Object(r.jsx)("p",{children:"All of the formatting preserved by Draft.js is preserved in the editor."}),Object(r.jsx)(G,{filtered:!1,extended:!1}),Object(r.jsx)("h2",{children:"Going further"}),Object(r.jsxs)("p",{children:["By default, Draft.js preserves quite a lot. Have a look at our\xa0",Object(r.jsx)("a",{className:"link",href:"https://github.com/thibaudcolas/draftjs-filters/tree/main/pasting",children:"full test suite"}),", and if there is anything that is missing please\xa0",Object(r.jsx)("a",{className:"link",href:"https://github.com/thibaudcolas/draftjs-filters/issues",children:"open an issue on GitHub"}),"."]}),Object(r.jsx)("p",{children:"Here are more ready-made rich text paste testing documents should you need them:"}),Object(r.jsxs)("ul",{className:"list-inline",children:[Object(r.jsx)("li",{children:Object(r.jsx)("a",{className:"link",href:"https://github.com/thibaudcolas/draftjs-filters/blob/main/pasting/documents/Draft.js%20paste%20test%20document%20Word2010.docx",target:"_blank",rel:"noopener noreferrer",children:"Microsoft Word 2010"})}),Object(r.jsx)("li",{children:Object(r.jsx)("a",{className:"link",href:"https://docs.google.com/document/d/1YjqkIMC3q4jAzy__-S4fb6mC_w9EssmA6aZbGYWFv80/edit",target:"_blank",rel:"noopener noreferrer",children:"Google Docs"})}),Object(r.jsx)("li",{children:Object(r.jsx)("a",{className:"link",href:"https://paper.dropbox.com/doc/Draft.js-paste-test-document-njfdkwmkeGQ9KICjVwLmU",target:"_blank",rel:"noopener noreferrer",children:"Dropbox Paper"})}),Object(r.jsx)("li",{children:Object(r.jsx)("a",{className:"link",href:"https://github.com/thibaudcolas/draftjs-filters/blob/main/pasting/documents/Draft.js%20paste%20test%20document.pages",target:"_blank",rel:"noopener noreferrer",children:"Apple Pages"})}),Object(r.jsx)("li",{children:Object(r.jsx)("a",{className:"link",href:"https://github.com/thibaudcolas/draftjs-filters/blob/main/pasting/documents/Draft.js%20paste%20test%20document%20Word2016%20macOS.docx",target:"_blank",rel:"noopener noreferrer",children:"Microsoft Word 2016 macOS"})}),Object(r.jsx)("li",{children:Object(r.jsx)("a",{className:"link",href:"https://1drv.ms/w/s!AuGin45FpiF5hjzm9QdWHYGqPrqm",target:"_blank",rel:"noopener noreferrer",children:"Microsoft Word Online"})}),Object(r.jsx)("li",{children:Object(r.jsx)("a",{className:"link",href:"tests",target:"_blank",rel:"noopener noreferrer",children:"HTML content"})})]}),Object(r.jsx)("p",{children:"Here is an editor with more formatting enabled:"}),Object(r.jsx)(G,{filtered:!1,extended:!0}),Object(r.jsx)("h3",{children:"Clipboard log"}),Object(r.jsx)(W,{})]})}}]),n}(i.Component),P=document.getElementById("root");P&&o.a.render(Object(r.jsx)(q,{}),P)},94:function(e,t,n){},95:function(e,t,n){},96:function(e,t,n){},97:function(e,t,n){},99:function(e,t,n){}},[[199,1,2]]]);
//# sourceMappingURL=main.4183a150.chunk.js.map